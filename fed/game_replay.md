# game replay

回放数据：电影、倒带、数据挖掘

## 概念

了解区分三种重播：
- 无交互重播：查看游戏中一系列事件的重播影片。称为“回放电影”。经典用例：Halo 2
- 交互回放：回放游戏并重做操作以更改结果。称为“倒带”。经典用例：Briad 
- 数据挖掘：能够“回放”用户数据，收集用户交互数据，以便能够调查用户的操作和行为。经典用例：Farmville

### 设计
实现回放功能的最简单方法是保存游戏中每个帧的每个对象状态。对于一个玩家，你会在每一帧保存它的位置、旋转、属性（生命值）等，不过，这将使每个游戏会话的数据总量达到千兆字节，若要减少保存的数据量，`应仅保存数据中的更改`，我把这些变化点称为“关键帧”。

- 方案一：仅保存玩家状态更改-不起作用，保存一系列开始向左移、停止向左移、开始向右移、停止向右移等
- 方案二：仅保存播放机控制更改-不正确的重播
  对于玩家控制，这一切归结为以下变化：按下哪个移动键（或释放）和在什么时候。如：
  ```
  6.300717: 向前移动 (开始/停止 向前 or 向后)
  6.556254: 向前移动 (开始/停止 向前 or 向后)
  7.596561: 侧移 (开始/停止 左 or 右)
  8.574206: 跳跃 (开始/停止)
  ```
  与方案1的不同之处在于，方案一没有向前启动/停止和向后启动/停止。重播不正确，每一个事件都失去了准确性，这是因为即使是很小的时间变化对物理计算也很重要，旋转可能会延迟几毫秒，从而大大改变了后面的步骤。
- 方案三： 对方案二补充
  每个事件/“关键帧”都应包括当时正确的旋转，位置和移动方向。数据变成如下：
  ```
    6.300717#0#1#0.71_1_4.72#0_108.04_0#0.95_0_-0.31
    6.556254#0#0#-0.26_1_5.03#0_288.04_0#-0.95_0_0.31
    6.764966#1#-1#-0.82_1_5.21#0_288.04_0#-0.95_0_0.31
    7.596561#1#0#-0.95_1_5.06#0_15.65_0#0.27_0_0.96
    8.574206#2#1#-0.72_1_5.89#0_15.65_0#0.27_0_0.96
  ```
  会出现的问题是在事件之间会出现一些滞后，用正确的值覆盖重放是显而易见的，添加一些平滑（lerping）可以帮助，但这只是另一个hack，不准确问题的根源应该用不同的方法来解决。

- 方案四：仅在运动变化时保存位置/旋转值，并在运行时计算所需的运动
  需要注意的是，所需的重播数据始终依赖于应用程序的本体/域，目标是创建一个可以为任何游戏定制的平台，运行重播时，应使用重播数据重新计算正确的移动，这使得回放非常流畅。
  在重新计算所需的移动方面还有一些工作，像一些靠墙跑，或旋转360还是720 等问题，修复这些问题只需要设置更为规则的关键帧，或者保存额外的数据。
  我决定在运行时重新计算所需的移动（在重播/倒带）将是此示例的最佳解决方案。 这样可以节省大量数据，并且重放可以顺利进行。

### 重放工作原理
- 维护所有的动作列表
- 维护自己的计时器和时间戳
- 水平或垂直移动添加关键帧

玩家位置每秒大约保存2次（取决于实际运动），箱子动作在拾取后仅触发一次，并且在您放置海报时触发海报事件。


## 设计方案

第一种解决方案是以帧为单位或以固定频率存储有关游戏世界（包括玩家）中所有对象的绝对信息。这将包括位置，方向等数据。然后通过将该信息流回游戏引擎并在必要时进行插值来构造重播序列。
第二种更优雅的方法是利用计算机软件的固有可预测性：对相同数据集执行的相同操作序列将始终产生相同结果。通过只记录游戏的初始状态以及玩家的输入，就可以精确地再现一系列的游戏过程。然后可以恢复初始状态，并重新应用已记录的输入，以产生相同的播放顺序。
     由于需要存储的数据量要少得多，因此该解决方案立即更具吸引力。由于所有必需的编码都可以在“玩家输入”级别进行，并且与底层游戏引擎无关，因此它的实现和维护也更加简单。



### 工具设计
背景：...
目标：...
总体设计：利用标注工具的固有可预测性，对相同数据集执行的相同操作序列将始终产生相同结果，通过只记录标注数据的初始状态以及标注员的一系列事件的操作，精确的再现一系列的标注过程。
功能拆解：
- 记录：
  - 统计所有事件的操作，维护所有事件的列表
    - 包括哪些操作？哪些是产生快照变动的操作？哪些是没产生变动的操作？是否要区分
  - 对上述统计的所有事件的操作，进行记录
    - 事件的操作 -> json数据
    - 以什么样的方式记录，更方便回放、统计及减少数据量？
- 回放：
  - 以任务维度，统计所有事件列表
  - 按序还原操作 



#### 事件统计
- 快捷键
  - 滚轮滚动缩放图片  
    [
      {
        created_at|mousewheel|scale
      }
      {
        created_at|mousewheel|end|scale
      }
    ]

  - 滚轮按下拖动移动图片
  - 拖动移动点位置

A选择上一个框
S选择下一个框
F将当前选中框放大居中显示
ESC删除当前选中框
T切换标注模式
B遮住/显示框及蒙板区域
Z图片顺时针旋转90度
H更改辅助线颜色
R显示/隐藏标尺框
Q识别匹配当前框的内容
P显示快捷键帮助文档
ALT + H显示/隐藏辅助线
ALT + ↑增加图片亮度
ALT + ↓减少图片亮度
ALT + 拖动移动选中框



有element_id




无element_id








{
    "classId": 99337,
    "priority": 1,
    "instanceId": null,
    "tags": [],
    "tool": null,
    "points": [
        [309, 111, "", false],
        [752.8508409471101, 375.1220451874102, "", false]
    ]
}

[{
    "id": 146641501,
    "imageId": 16451882,
    "classId": 99337,
    "editable": true,
    "instanceId": null,
    "priority": 1,
    "bitmap": null,
    "points": [
        [309, 111],
        [531, 246]
    ],
    "pointsCount": 2,
    "description": "",
    "area": 29970,
    "createdAt": "2019-01-18T07:46:04.557Z",
    "updatedAt": "2019-01-28T17:41:19.843Z",
    "createdBy": 2984,
    "name": "caihao",
    "login": "charls",
    "datasetId": 11247,
    "tags": [],
    "userName": "caihao"
}]